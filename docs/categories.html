<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Categories - Budget Bot</title>
  <link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
  <header>
    <a href="index.html" style="color:#fff;text-decoration:none;">‚Üê Back</a>
    <h1>Categories</h1>
  </header>

  <div class="card">
    <h2>Add Category</h2>
    <label for="catName">Name</label>
    <input type="text" id="catName" placeholder="e.g. Groceries"/><br><br>

    <label for="catIsRent">Is Rent?</label>
    <input type="checkbox" id="catIsRent" /><br><br>

    <label for="catBW">Biweekly Budget ($)</label>
    <input type="number" step="0.01" id="catBW" placeholder="500.00"/><br><br>

    <label for="catMO">Monthly Budget ($)</label>
    <input type="number" step="0.01" id="catMO" placeholder="1000.00"/><br><br>

    <button id="addCatBtn" class="btn">Add Category</button>
  </div>

  <div class="card">
    <h2>Existing Categories</h2>
    <ul id="catList"></ul>
  </div>

  <!-- We'll load firebase.js as a module,
       plus the Firestore functions we need -->
  <script type="module">
    import { db } from "./firebase.js";
    import {
      collection, addDoc, getDocs, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const addCatBtn = document.getElementById("addCatBtn");
    const catName = document.getElementById("catName");
    const catIsRent = document.getElementById("catIsRent");
    const catBW = document.getElementById("catBW");
    const catMO = document.getElementById("catMO");

    const catList = document.getElementById("catList");

    // On page load:
    document.addEventListener("DOMContentLoaded", loadCategoriesUI);
    // Add new category on button click
    addCatBtn.addEventListener("click", createCategory);

    async function loadCategoriesUI() {
      // Clear the list
      catList.innerHTML = "";
      try {
        // fetch all docs from 'categories' collection
        const collRef = collection(db, "categories");
        const snap = await getDocs(collRef);

        let cats = [];
        snap.forEach(docSnap => {
          cats.push({ id: docSnap.id, ...docSnap.data() });
        });

        cats.forEach(cat => {
          const li = document.createElement("li");
          let displayText = `${cat.name}: BW=$${cat.biweekly || 0} | MO=$${cat.monthly || 0}`;
          li.textContent = displayText;


          const delBtn = document.createElement("button");
          delBtn.textContent = "Delete";
          delBtn.style.marginLeft = "1rem";
          delBtn.onclick = async () => {
            if (confirm(`Delete category ${cat.name}?`)) {
              await deleteDoc(doc(db, "categories", cat.id));
              loadCategoriesUI();
            }
          };

          li.appendChild(delBtn);
          catList.appendChild(li);
        });
      } catch(err) {
        alert("Error loading categories: " + err.message);
      }
    }

    async function createCategory() {
      const name = catName.value.trim();
      if (!name) {
        alert("Please enter a category name.");
        return;
      }
      const isRentVal = catIsRent.checked;
      const bwVal = parseFloat(catBW.value) || 0;
      const moVal = parseFloat(catMO.value) || 0;

      try {
        const collRef = collection(db, "categories");
        await addDoc(collRef, {
          name,
          isRent: isRentVal,
          biweekly: bwVal,
          monthly: moVal,
          createdAt: Date.now()
        });
        catName.value = "";
        catIsRent.checked = false;
        catBW.value = "";
        catMO.value = "";
        loadCategoriesUI();
      } catch(err) {
        alert("Error creating category: " + err.message);
      }
    }
  </script>
</body>
</html>
